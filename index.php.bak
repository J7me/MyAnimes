<?php
include 'fetch_anime.php';
?>
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Аниме по жанрам</title>
   <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div class="container">
        <h1>Аниме по жанрам</h1>

        <form method="GET">
            <select name="genre">
                <option value="">— Выберите жанр —</option>
                <?php foreach ($genres as $g): ?>
                    <option value="<?= $g['id'] ?>" <?= ($genreId == $g['id'] ? 'selected' : '') ?>>
                        <?= e($g['russian']) ?>
                    </option>
                <?php endforeach; ?>
            </select>

            <button type="submit">Показать</button>
        </form>

        <?php if ($selectedGenre): ?>
            <h2>Жанр: <?= e($selectedGenre['russian']) ?></h2>

            <div class="grid">
                <?php foreach ($animeList as $anime): ?>
                    <?php
                    $img = $anime['image']['preview'] ?? null;
                    if ($img && strpos($img, 'http') !== 0) $img = 'https://shikimori.one' . $img;
                    ?>
                    <a class="card" href="https://shikimori.one<?= e($anime['url']) ?>" target="_blank">
                        <img src="<?= e($img) ?>" alt="">
                        <div class="card-title"><?= e($anime['russian'] ?? $anime['name']) ?></div>
                    </a>
                <?php endforeach; ?>
            </div>

            <!-- Пагинация -->
            <div class="pagination">
                <?php if ($page > 1): ?>
                    <a class="page-btn" href="?genre=<?= e($genreId) ?>&page=<?= $page - 1 ?>">« Назад</a>
                <?php endif; ?>

                <span class="page-btn active"><?= $page ?></span>

                <?php if (count($animeList) == $limit): ?>
                    <a class="page-btn" href="?genre=<?= e($genreId) ?>&page=<?= $page + 1 ?>">Вперед »</a>
                <?php endif; ?>
            </div>
        <?php endif; ?>
    </div>

</body>

</html>